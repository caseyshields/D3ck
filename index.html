<!DOCTYPE html>
<html>
    <head>
        <link rel="icon" type="image/svg+xml" href="./favicon.svg">
        <title>Shields</title>
        <link rel="stylesheet" href="./index.css">
    </head>
    <body>

        <!-- A CSS trick hero! -->
        <div class="hero">
            <a href="#contacts">
                <svg
                    version="1.1"
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 128 128">
                    <use href="#shield"></use>
                </svg>
            </a>
        </div>

        <!-- contacts bar -->
        <header id="contacts" class="banner">
            <a href="mailto:caseyorigami@gmail.com"> 
                Casey <svg viewBox="0 0 128 128"><use href="#shield"></use></svg> Shields
            </a>
            <a href="https://github.com/caseyshields/"> 
                <svg viewBox="0 0 98 98"><use href="#github"></use></svg> Github
            </a>
            <a href="https://rebrickable.com/users/deceptibot/mocs/">
                <svg viewBox="0 0 26 26"><use href="#lego"></use></svg> Rebrickable
            </a>
            <!-- <a href="https://www.pinterest.com/caseyorigami/"> Pinterest </a> -->
            <a href="https://www.instagram.com/caseyorigami/"> 
                <svg viewBox="0 0 300 300"><use href="#instagram"></use></svg> Instagram </a>
        </header>

        <!-- Navigation bar holds filters and sorting options for cards -->
        <aside class="toggles">
            <div class="tag">
            </div>
            <div class="tag">
            </div>
            <div class="tag">
            </div>
            <!-- these are removable placeholders that matches the markup the card component generates. -->
            <!-- this gives you styled place holders until your content loads and the components are populated -->
        </aside>

        <!-- Where the site content is displayed -->
        <section class="deck">
            <article class="card">
                <a></a>
                <div></div>
                <ul>
                    <li></li><li></li><li></li>
                </ul>
            </article>
            <article class="card">
                <a></a>
                <div></div>
                <ul>
                    <li></li><li></li><li></li>
                </ul>
            </article>
            <article class="card">
                <a></a>
                <div></div>
                <ul>
                    <li></li><li></li><li></li>
                </ul>
            </article>
            <article class="card">
                <a></a>
                <div></div>
                <ul>
                    <li></li><li></li><li></li>
                </ul>
            </article>
            <!-- More placeholders, this time for cards. -->
            <!-- Instead of placeholders, you could also statically generate your first page of results... -->
        </section>

        <!-- copyright and disclaimers -->
        <footer class="banner">
            <a href="https://github.com/caseyshields/d3ck">source</a>
            <span>&#169; 2020</span>
        </footer>
        
        <!-- For displaying links in a dismissable modal. -->
        <section class="preview hide">
            <iframe
                src=""
                scrolling="yes"
                frameborder="0">
            </iframe>
        </section>

        <!-- A section for displaying slideshows -->
        <section class="slideshow hide">
            <nav></nav>
            <div></div>
        </section>
        
        <!-- Hidden SVG holding all the SVG icon definitions -->
        <svg style="display:none;">
            <defs>
                <!-- viewBox="0 0 98 98" -->
                <path id="github" fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"/>
                <!-- viewBox="0 0 300 300" -->
                <path id="instagram" d="M38.52,0.012h222.978C282.682,0.012,300,17.336,300,38.52v222.978c0,21.178-17.318,38.49-38.502,38.49   H38.52c-21.184,0-38.52-17.313-38.52-38.49V38.52C0,17.336,17.336,0.012,38.52,0.012z M218.546,33.329   c-7.438,0-13.505,6.091-13.505,13.525v32.314c0,7.437,6.067,13.514,13.505,13.514h33.903c7.426,0,13.506-6.077,13.506-13.514   V46.854c0-7.434-6.08-13.525-13.506-13.525H218.546z M266.084,126.868h-26.396c2.503,8.175,3.86,16.796,3.86,25.759   c0,49.882-41.766,90.34-93.266,90.34c-51.487,0-93.254-40.458-93.254-90.34c0-8.963,1.37-17.584,3.861-25.759H33.35v126.732   c0,6.563,5.359,11.902,11.916,11.902h208.907c6.563,0,11.911-5.339,11.911-11.902V126.868z M150.283,90.978   c-33.26,0-60.24,26.128-60.24,58.388c0,32.227,26.98,58.375,60.24,58.375c33.278,0,60.259-26.148,60.259-58.375   C210.542,117.105,183.561,90.978,150.283,90.978z"/>
                <!-- viewbox="0 0 128 128"-->
                <path id="shield" d="
                    M 64,0
                    q -32,32 -64,0
                    q 0,94 64,128
                    q 64,-32 64,-128
                    q -32,32 -64,0"/>
                <g id="lego">
                    <path d="M21.677,9.896c-0.208,0-0.415,0.042-0.582,0.295c-0.416,0.547-1.578,3.749-1.537,4.38
                        c0,0.212,0.125,0.421,0.416,0.421s0.498-0.209,0.664-0.506c0.334-0.588,1.372-3.453,1.412-4.169
                        C22.05,10.148,22.01,9.896,21.677,9.896z"/>
                    <path d="M20.904,0H5.096C2.293,0,0,2.293,0,5.094v15.813C0,23.707,2.293,26,5.096,26h15.809
                        C23.707,26,26,23.707,26,20.906V5.094C26,2.293,23.707,0,20.904,0z M3.399,16.972c-0.789,0-1.495-0.379-1.495-1.305
                        c-0.041-1.644,1.577-5.435,2.368-6.656c0.373-0.59,0.789-0.885,1.494-0.885c0.666,0,0.832,0.338,0.789,0.717
                        c0,1.095-1.743,4.423-2.325,5.728c1.37-0.211,1.703,0.253,1.66,0.759C5.767,16.72,4.52,17.014,3.399,16.972z M8.675,13.308
                        c-0.082,0.253-0.249,0.759-0.374,1.307c0.458-0.085,0.789-0.169,1.37-0.169c0.625,0,1.081,0.294,1.081,0.842
                        c0,1.349-1.496,1.727-2.492,1.727c-1.122,0-2.077-0.631-2.077-1.853c0-1.475,0.747-3.665,1.495-5.098C8.55,8.253,9.465,8,11.042,8
                        c0.666,0,1.496,0.338,1.496,0.97c0,0.927-0.79,1.264-1.536,1.306c-0.333,0.042-0.832,0.042-1.123,0.042
                        c0,0-0.248,0.379-0.497,1.053c1.37-0.168,1.993,0.127,1.743,0.97C10.793,13.434,9.838,13.518,8.675,13.308z M17.148,13.434
                        c-0.416,1.979-1.785,3.58-3.779,3.58c-1.371,0-2.201-0.758-2.201-2.148c0-1.01,0.498-2.568,0.871-3.496
                        c0.832-1.937,1.704-3.326,3.903-3.326c1.332,0,2.37,0.505,2.203,1.77c-0.124,0.925-0.581,1.431-1.37,1.515
                        c-0.25,0-1.204,0-0.872-0.926c0.083-0.295,0.166-0.549-0.332-0.549c-0.375,0-0.623,0.254-0.79,0.507
                        c-0.416,0.59-1.288,2.906-1.412,3.832c-0.125,0.674,0.165,0.8,0.457,0.8c0.498,0,1.038-0.546,1.246-1.39
                        c0,0-0.955-0.041-0.707-0.842c0.25-0.842,0.748-1.011,1.538-1.053C17.439,11.665,17.274,12.802,17.148,13.434z M23.919,11.496
                        c-0.249,1.18-0.789,2.57-1.327,3.58c-0.957,1.727-2.078,1.938-3.034,1.938c-0.997,0-2.118-0.378-2.118-1.938
                        c0-1.095,0.457-2.652,0.873-3.664c0.705-1.854,1.411-3.369,3.653-3.327C24.584,8.085,24.127,10.484,23.919,11.496z"/>
                </g>
            </defs>
        </svg>

        <script src="https://d3js.org/d3.v5.js" charset="utf-8"></script>
        <script src="./content.js" charset="utf-8"></script>
        <script type="module">
            import D3ck from './deck/d3ck.js';
            import Card from './deck/card.js';
            import Frame from './deck/frame.js';
            import Tags from './deck/tags.js';
            import Slides from './deck/slides.js';
            let Window = document.defaultView

            // TODO in the future get this from some CMS or document database...
            let content = getContent();
            console.log(content);

            // Create the framework's context, which includes a dispatch for components' events
            let deck = D3ck();

            // for example, here we handle a 'navigate' event by changing the browser URL
            deck.dispatch.on('navigate', function(d) {
                Window.location.assign(d.link);
            } );

            // Create the Card components which will generate events when their entries are clicked
            let section = d3.select('.deck');
            let cards = Card(deck, section);
            cards(content); // invoke the render method on the content

            // create the preview modal, it also registers to listen to 'preview' events on construction
            let frame = Frame(deck, d3.select('body'));
            frame({}); // TODO actually the app should register events, not the component...

            // create the slideshow modal
            let slideshow = d3.select('.slideshow');
            let slides = Slides(deck, slideshow);
            slides({});
            deck.dispatch.on('carousel', function(d) {
                slides( d.slides );
                slides.show();
            });

            // add the tag toggles and wire them into the application
            let nav = d3.select('.toggles');
            let tags = Tags(deck, nav);
            tags(content); // pass the content data to the default render method
            cards.filter( tags.filter ); // set the card's filter to the one supplied by the tags component
            deck.dispatch.on('filter', function(d) {
                cards(content);
            }); // on a filter event re-render the cards.

            // Apply any URL query parameters
            let params = (new URL(document.location)).searchParams;
            let tagParam = params.get('tags');
            if (tagParam!=null && tagParam!=undefined) {
                let tagList = tagParam.split(',');
                tags.toggle( tagList );
            }//TODO I should update document location as tags change...

            // // this shadow effect might be eye-bleeding. it is also neat.
            // d3.select('body').on('mousemove', function(item, index, selection) {
            //     let height = 50;
            //     let screen = d3.mouse(this);
            //     let bounds = [Window.outerWidth, Window.outerHeight];

            //     section.selectAll('article.card')
            //         .style('box-shadow', function(d) {
            //             let factor = 20;
            //             let centroid = [ this.offsetLeft + (this.offsetWidth/2),
            //                     this.offsetTop + (this.offsetHeight/2) ];
            //             let shadow = [ Math.floor((centroid[0]-screen[0])/factor),
            //                     Math.floor((centroid[1]-screen[1])/factor) ];
            //             return `${shadow[0]}px ${shadow[1]}px 15px 10px rgba(0.0,0.0,0.0,0.1)`;
            //             // TODO shadows should always be below content- also don't render off screen ones...
            //         });
            // });
        </script>
    </body>
</html>